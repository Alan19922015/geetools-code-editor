/***
 * Tests for cloud mask functions
 * 
 * Author: Rodrigo E. Principe
 * email: fitoprincipe82@gmail.com
 * License: MIT
 */
 
 var s2mask = require('users/fitoprincipe/geetools:cloud_masks').sentinel2
 var landsatSR = require('users/fitoprincipe/geetools:cloud_masks').landsatSR
 
 var sentinel2 = function() {
   var cent = Map.getCenter();
   var col = ee.ImageCollection('COPERNICUS/S2')
             .filterBounds(cent)
             .filterMetadata('CLOUDY_PIXEL_PERCENTAGE', 'greater_than', 40)
             //.filterDate('2017-01-01', '2017-03-01')
             .sort('CLOUDY_PIXEL_PERCENTAGE');
   
   var img = ee.Image(col.first());
   var vis = {bands:['B8', 'B12', 'B4'], min:0, max:5000}
   var masked = s2mask(img);
   Map.addLayer(masked, vis, 'Sentinel 2 masked');
   Map.addLayer(img, vis, 'Sentinel 2 NOT masked', false);
   Map.centerObject(img)
 };
 
 
 var landsat8SR = function(options) {
   var cent = Map.getCenter();
   var col = ee.ImageCollection('LANDSAT/LC08/C01/T1_SR')
             .filterBounds(cent)
             .filterMetadata('CLOUD_COVER', 'greater_than', 40)
             //.filterDate('2017-01-01', '2017-03-01')
             .sort('CLOUD_COVER');
   
   var img = ee.Image(col.first());
   var vis = {bands:['B5', 'B7', 'B4'], min:0, max:5000}
   var masked = landsatSR(options)(img);
   print(masked)
   Map.addLayer(masked, vis, 'Landsat 8 SR masked');
   Map.addLayer(img, vis, 'Landsat 8 SR NOT masked', false);
   Map.centerObject(img)
 };
 
 exports.sentinel2 = sentinel2
 exports.landsat8SR = landsat8SR