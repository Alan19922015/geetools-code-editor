/**
 * CheckSelect Widget
 * Author: Rodrigo E. Principe
 * email: fitoprincipe82@gmail.com
 * license: MIT
 **/
 
var helpers = require('users/fitoprincipe/geetools:helpers_js')

var CheckSelect = function(options) {
  var def = {
    items: [],
    checkbox: {
      style: {
        padding: '8px 0px 8px 0px'
      }
    },
    select: {
      style: {
      }
    },
    panel: {
      style: {
        padding: '0px 0px 0px 0px'
      },
      layout: ui.Panel.Layout.flow('horizontal')
    }
  }
  this.options = helpers.get_options(def, options)
  
  this.options.select.items = this.options.items
  
  this.checkbox = ui.Checkbox(this.options.checkbox)
  this.select = ui.Select(this.options.select)
  
  this.options.panel.widgets = [this.checkbox, this.select]
  
  this.panel = ui.Panel(this.options.panel)
  
  // Inherit
  this.items = this.select.items()
  
  this.select.onChange(this.callback())
}

CheckSelect.prototype.callback = function() {
  var self = this
  var wrap = function(value, widget) {
    if (self.onSelectCallback) {
      self.onSelectCallback(value, widget, self.checkbox.getValue(), self.checkbox)
    }
  }
  return wrap
}

CheckSelect.prototype.onSelect = function(callback) {
  this.onSelectCallback = callback
}

CheckSelect.prototype.build = function() {
  return this.panel
}

CheckSelect.prototype.addTo = function(widget) {
  widget.add(this.build())
  this.parent = widget
  return widget
}

CheckSelect.prototype.insertTo = function(widget, position) {
  widget.insert(position, this.build())
  this.parent = widget
  return widget
}

exports.CheckSelect = CheckSelect
